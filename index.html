<!doctype html>
<html lang="th">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô KPI</title>

<script src="https://cdn.tailwindcss.com"></script>

<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&display=swap" rel="stylesheet">

<style>

body{
font-family:'Sarabun',sans-serif;
height:100vh;
background:#f3f4f6;
display:flex;
flex-direction:column;
}

.main-card{
background:white;
border-radius:20px;
box-shadow:0 20px 25px rgba(0,0,0,.08);
max-width:950px;
width:100%;
margin:auto;
display:flex;
overflow:hidden;
}

@media(max-width:768px){
.main-card{flex-direction:column;margin:20px;}
}

.login-section{
padding:3rem;
flex:1;
}

.info-section{
background:linear-gradient(135deg,#667eea,#764ba2);
color:white;
padding:2rem;
flex:.9;
}

.form-input{
width:100%;
padding:.7rem;
border:2px solid #e5e7eb;
border-radius:8px;
}

.btn-primary{
width:100%;
background:linear-gradient(to right,#4f46e5,#7c3aed);
color:white;
padding:.9rem;
border-radius:8px;
font-weight:bold;
}

.event-item{
background:rgba(255,255,255,.1);
padding:.7rem;
border-radius:8px;
margin-bottom:.6rem;
display:flex;
align-items:flex-start;
border-left:4px solid #fbbf24;
}

.today{
border-left:4px solid #22c55e;
background:rgba(34,197,94,.2);
}

</style>
</head>

<body>

<main style="flex:1;display:flex;align-items:center;justify-content:center;padding-bottom:40px;">

<div class="main-card">

<!-- LOGIN -->
<div class="login-section">

<h1 class="text-2xl font-bold mb-6 text-center">
‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô KPI
</h1>

<form onsubmit="checkPassword(event)">

<label class="font-bold text-sm">
1. ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å KPI
</label>

<select id="login-month"
class="form-input mt-1 mb-4"
onchange="updateCalendar()">
</select>

<label class="font-bold text-sm">
2. ‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß
</label>

<input type="password"
id="login-password"
class="form-input text-center mt-1"
required>

<p id="error-msg"
class="text-red-500 hidden font-bold text-center mt-2">
‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
</p>

<button class="btn-primary mt-4">
‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
</button>

</form>

</div>


<!-- CALENDAR -->
<div class="info-section">

<div class="flex justify-between mb-3">
<h2 class="font-bold">üìÖ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</h2>

<span id="calendar-month-label"
class="bg-white text-indigo-700 px-2 rounded">
</span>
</div>

<div id="calendar-container">
‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...
</div>

<div id="no-events-msg"
class="hidden text-center opacity-70 mt-6">
‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ
</div>

</div>

</div>
</main>


<script>

// ===================================
// CONFIG
// ===================================

const API_URL = "https://script.google.com/macros/s/AKfycbwJENSbxWNTpn59s5HTnwJg272rE1vV_Vhj1RqninlKPM4Ps2vY_Rxnhp7KKFncLgdl-g/exec";

let allEvents=[];
let users=[];

let calendarMonth; // ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
let reportMonth;   // ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡∏£‡∏≠‡∏Å‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á


const thaiMonths=[
"‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°","‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå","‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°","‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô",
"‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°","‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô","‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°","‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°",
"‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô","‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°","‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô","‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"
];


// ===================================
// INIT ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
// ===================================

document.addEventListener('DOMContentLoaded', init);

async function init(){

await loadConfig();     // ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô
generateDropdown();     // ‡∏™‡∏£‡πâ‡∏≤‡∏á dropdown
await loadEvents();     // ‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô
await loadUsers();      // ‡πÇ‡∏´‡∏•‡∏î user

updateCalendar(calendarMonth); // ‚≠ê ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô

}


// ===================================
// LOAD CONFIG (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)
// ===================================

async function loadConfig(){

const res=await fetch(API_URL+"?type=config");
const config=await res.json();

calendarMonth=config.calendarMonth;
reportMonth=config.reportMonth;

}


// ===================================
// DROPDOWN
// ===================================

function generateDropdown(){

const select=document.getElementById('login-month');

for(let i=1;i<=12;i++){

const option=document.createElement("option");
option.value=i;
option.textContent=thaiMonths[i-1];

select.appendChild(option);

}

select.value=reportMonth; // ‚≠ê ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á

}


// ===================================
// LOAD EVENTS
// ===================================

async function loadEvents(){

const res=await fetch(API_URL+"?type=calendar");
allEvents=await res.json();

allEvents.sort((a,b)=>parseInt(a.day)-parseInt(b.day));

}


// ===================================
// LOAD USERS
// ===================================

async function loadUsers(){

const res=await fetch(API_URL+"?type=users");
users=await res.json();

}


// ===================================
// CALENDAR
// ===================================

function updateCalendar(monthOverride){

const monthId = monthOverride ??
parseInt(document.getElementById('login-month').value);

const container=document.getElementById('calendar-container');
const noEvents=document.getElementById('no-events-msg');

document.getElementById('calendar-month-label')
.textContent=thaiMonths[monthId-1];

const today=new Date().getDate();

const events=allEvents.filter(e=>e.monthId===monthId);

container.innerHTML="";

if(events.length){

noEvents.classList.add('hidden');

container.innerHTML=events.map(evt=>`

<div class="event-item ${evt.day==today?'today':''}">

<div class="mr-3 font-bold">
${evt.day}
</div>

<div>
<div class="font-bold">${evt.title}</div>
<div class="text-sm opacity-80">${evt.time}</div>
<div class="text-xs opacity-70">${evt.location??''}</div>
</div>

</div>

`).join('');

}else{

noEvents.classList.remove('hidden');

}

}


// ===================================
// LOGIN
// ===================================

let currentUser=null;

function checkPassword(e){

e.preventDefault();

const password=document
.getElementById('login-password')
.value.trim();

const user=users.find(u=>u.password==password);

if(!user){

document
.getElementById('error-msg')
.classList.remove('hidden');

return;
}

currentUser=user;

openSheet();

}


// ===================================
// OPEN SHEET
// ===================================

function openSheet(){

const month=parseInt(
document.getElementById('login-month').value
);

const link=currentUser["m"+month];

if(link){

window.open(link,'_blank');

}else{

alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ");

}

}

</script>

</body>
</html>










